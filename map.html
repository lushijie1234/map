<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>AutoCruise Map</title>
    <style>
        html, body, #container { width: 100%; height: 100%; margin: 0; padding: 0; }
    </style>
    <script>
        window._AMapSecurityConfig = {
          securityJsCode: "5b6b64399e3ef9bbf2d4464b9f861125"
        };
        // 调试：捕获所有JS错误
        window.onerror = function(message, source, lineno, colno, error) {
          console.log('【map.html错误】', message, source, lineno, colno, error);
        };
        // 调试：输出location参数
        console.log('【map.html参数】', location.search);
    </script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=c814ffc35f2a5e5c94cd14b3ce1fc4fc"></script>
</head>
<body>
<h1 style="color:red">Web组件已加载</h1>
<script>alert('Web组件已加载');</script>
<div id="container"></div>
<script>
    var lng = 116.397428, lat = 39.90923;
    if (window.location.search) {
      var params = new URLSearchParams(window.location.search);
      lng = parseFloat(params.get('lng')) || lng;
      lat = parseFloat(params.get('lat')) || lat;
    }
    var map = new AMap.Map('container', {
      zoom: 15,
      center: [lng, lat]
    });
    var marker = new AMap.Marker({
      position: [lng, lat]
    });
    map.add(marker);
    
    // 新增：点击地图保存经纬度到window.lastClickedPoint
    map.on('click', function (e) {
      var clickLng = e.lnglat.getLng();
      var clickLat = e.lnglat.getLat();
      window.lastClickedPoint = { lng: clickLng, lat: clickLat };
      // 可选：在地图上添加标记
      new AMap.Marker({ position: [clickLng, clickLat], map: map });
    });
</script>
</body>
</html> 